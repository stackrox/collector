name: Collector Integration Tests

on: 
  pull_request:
    types: [opened, reopened, synchronize, labeled]
    branches:
      - master
  push:
    branches:
      - master

jobs:
  all-integration-tests:
    uses: ./.github/workflows/integration-tests-vm-type.yml
    if: contains(github.event.pull_request.labels.*.name, 'all-integration-tests')
    strategy:
      # ensure that if one part of the matrix fails, the
      # rest will continue
      fail-fast: false
      matrix:
        vm_type:
          - rhel
          - ubuntu-os
          - cos
          - flatcar
          - fedora-coreos
          - rhel-sap
          - sles
          - garden-linux
    with:
      vm_type: ${{ matrix.vm_type }}
      collector_tag: 3.12.0
    secrets: inherit

  default-integration-tests:
    uses: ./.github/workflows/integration-tests-vm-type.yml
    if: ${{ ! contains(github.event.pull_request.labels.*.name, 'all-integration-tests') }}
    strategy:
      # ensure that if one part of the matrix fails, the
      # rest will continue
      fail-fast: false
      matrix:
        vm_type:
          - rhel
          - ubuntu-os
    with:
      vm_type: ${{ matrix.vm_type }}
      collector_tag: 3.12.0
    secrets: inherit
