name: Main collector CI

on:
  pull_request:

permissions:
  pull-requests: write

jobs:
  init:
    uses: ./.github/workflows/init.yml

  send-notification:
    runs-on: ubuntu-latest
    needs: init
    steps:
      - name: Slack notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_COLLECTOR_NOTIFICATIONS_WEBHOOK }}
          SLACK_CHANNEL: team-acs-collector-notifications
          SLACK_COLOR: failure
          SLACK_LINK_NAMES: true
          SLACK_TITLE: "Notification test."
          MSG_MINIMAL: actions url,commit
          SLACK_MESSAGE: |
            @acs-collector-team
      - name: Slack oncall
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_COLLECTOR_ONCALL_WEBHOOK }}
          SLACK_CHANNEL: team-acs-collector-oncall
          SLACK_COLOR: failure
          SLACK_LINK_NAMES: true
          SLACK_TITLE: "Oncall test."
          MSG_MINIMAL: actions url,commit
          SLACK_MESSAGE: |
            @acs-collector-team
