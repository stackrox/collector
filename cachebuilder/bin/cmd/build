#!/bin/bash
set -e
date
echo "Building..."
if test "$(uname)" = Darwin ; then
	echo "Building on Darwin is not supported. Please use Debian or Ubuntu"
	exit 1
fi

sudo rm -rf  fastcompile/build-output
if test ! -d fastcompile/build-output ; then
	mkdir fastcompile/build-output
	chmod 777 fastcompile/build-output
fi

(cd fastcompile/builder/sysdig && make)
(cd fastcompile && make)
docker-compose rm -f
docker-compose build
time docker-compose up --abort-on-container-exit
date
exit 0
