#!/bin/bash

set -e
CMD=${1-help}
export SRBCACHEDIR=$HOME/.srbcache
STARTING_DIR=$PWD
pushd . >/dev/null
cd $(dirname $0)
CB_BIN="$PWD"
CB_TOP=$(dirname $CB_BIN)
popd >/dev/null
CB_USR=$CB_TOP/usr

if test ! -d $HOME/.srbcache ; then
  echo "Initializing cache..."
  $CB_BIN/cmd/clear-cache >/dev/null
fi

if test "$CMD" = "--help" -o "$CMD" = "-help" -o "$CMD" = "-h" ; then
  CMD="help"
fi

if test "$CMD" = "help" ; then
  cat $CB_USR/srb/help.txt
  exit 0
fi

if test -x "$CB_BIN/cmd/$CMD" ; then
  shift
  cd $CB_TOP
  exec $CB_BIN/cmd/$CMD "$@"
fi

echo "Unknown command: $CMD"
exit 1
