version: '3.2'

services:

  collector:
    image: "stackrox/collector:${COLLECTOR_TAG}"
    environment:
    - 'GRPC_SERVER=grpc-server:9999'
    - 'COLLECTOR_CONFIG={"logLevel":"debug","turnOffScrape":true,"scrapeInterval":"2"}'
    - 'COLLECTION_METHOD=kernel_module'
    - 'MODULE_DOWNLOAD_BASE_URL=https://collector-modules.stackrox.io/612dd2ee06b660e728292de9393e18c81a88f347ec52a39207c5166b5302b656'
    restart: always
    privileged: true
    networks:
    - collector
    volumes:
    - /var/run/docker.sock:/host/var/run/docker.sock:ro
    - /proc:/host/proc:ro
    - /etc:/host/etc:ro
    - /sys/module:/host/sys/module:ro
    - /dev:/host/dev:ro

  grpc-server:
    image: stackrox/grpc-server:2.3.16.0-99-g0b961f9515
    ports:
    - "9999"
    networks:
    - collector
    volumes:
    - /tmp:/tmp:rw

networks:
  collector:
