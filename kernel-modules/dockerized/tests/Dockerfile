ARG COLLECTOR_TAG

FROM kernel-builder:latest AS drivers

FROM stackrox/collector:$COLLECTOR_TAG

COPY --from=drivers /kernel-modules/ /kernel-modules/
# Make modules for the current collector version available in /kernel-modules
RUN mv -v /kernel-modules/$(cat /kernel-modules/MODULE_VERSION.txt)/*.gz /kernel-modules/
# Remove all versioned subdirectories under /kernel-modules
RUN find /kernel-modules/ -mindepth 1 -maxdepth 1 -type d -delete

RUN ls -la /kernel-modules
